# Brooklyn Data Summary

The main assessment for analytics is from SQL query in the current folder named "brooklyn_part1.sql". 
The SQL query in the current folder named "brooklyn_test.sql" provides reasoning for missing/null data for
product data and categories. 

__Contents:__

- [Part I - Cte1: order_details](#part-i---cte1-order_details)
- [Part I - Cte2: top_3_product_categories](#part-i---cte2-top_3_product_categories)

## Part I - Cte1: order_details

- **Purpose**: The order_details is creating a re-usable way to track customers and orders by joining
               brooklyndata.olist_orders_dataset, brooklyndata.olist_order_payments_dataset, and
               brooklyndata.olist_order_customer_dataset based on the given data definitions and relationships.
- **Description**: This creates order_purchase_date, orders_count, customers_making_orders_count,
                   and revenue_usd. The primary key of this CTE is set on order_purchase_date.
- **Code**:
  ```sql
  SELECT
        DATE_TRUNC('day', o.order_purchase_timestamp) AS order_purchase_date,
        COUNT(DISTINCT o.order_id) AS orders_count,
        COUNT(DISTINCT oc.customer_id) AS customers_making_orders_count,
        SUM(op.payment_value) AS revenue_usd
    FROM
        brooklyndata.olist_orders_dataset o
    INNER JOIN
        brooklyndata.olist_order_payments_dataset op
    ON
        o.order_id = op.order_id
    INNER JOIN
        brooklyndata.olist_order_customer_dataset oc
    ON
        o.customer_id = oc.customer_id
    GROUP BY DATE_TRUNC('day', o.order_purchase_timestamp)
# Part I - Cte2: top_3_product_categories

- **Purpose**: The top_3_product_categories CTE is designed to track data related to product categories with a focus on revenue. It extracts information from various tables, including brooklyndata.olist_orders_dataset, brooklyndata.olist_order_items_dataset, and brooklyndata.product_category_name_translation, based on the provided data definitions and relationships.

- **Description**: This CTE generates the following key metrics:
  - `order_purchase_date`: The date of the order, truncated to day granularity.
  - `product_category_name`: The name of the product category.
  - `category_revenue`: The total revenue generated by products in the specified category.

- **Primary Key**: The primary key of this CTE is set on `order_purchase_date`.

- **SQL Code**:
  ```sql
  SELECT
      DATE_TRUNC('day', o.order_purchase_timestamp) AS order_purchase_date,
      pc.product_category_name,
      SUM(oi.price * oi.order_item_id) AS category_revenue
  FROM
      brooklyndata.olist_orders_dataset o
  INNER JOIN
      brooklyndata.olist_order_items_dataset oi
  ON
      o.order_id = oi.order_id
  INNER JOIN
      brooklyndata.olist_products_dataset p
  ON
      oi.product_id = p.product_id
  LEFT JOIN
      brooklyndata.product_category_name_translation pc
  ON
      p.product_category_name = pc.product_category_name
  GROUP BY
      DATE_TRUNC('day', o.order_purchase_timestamp),
      pc.product_category_name
  ORDER BY
      order_purchase_date,
      category_revenue DESC
